@if (post) {

<div class="container mb-5">
  <div class="card post-form-card shadow-lg border-0 overflow-hidden">
    <div class="card-body p-5">
      <!-- Title -->
      <h5 class="card-title mb-4 fw-bold text-dark">
        <i class="bi bi-pencil-square-fill me-3 text-primary"></i>
        Update Blog Post
      </h5>
      <form #updateForm="ngForm" (ngSubmit)="submit(updateForm)">
        <div class="mb-4">
          <input
            type="text"
            class="form-control form-control-lg title-input"
            name="title"
            [(ngModel)]="post.title"
            placeholder="Enter your blog title..."
            required
            minlength="5"
          />
          <div class="form-text text-muted mt-2">Minimum 5 characters</div>
        </div>
        <div class="mb-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <label class="form-label fw-semibold">Content (Markdown)</label>
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary"
              (click)="togglePreview()"
            >
              <i class="bi" [class.bi-eye]="!showPreview" [class.bi-eye-slash]="showPreview"></i>
              {{ showPreview ? 'Edit' : 'Preview' }}
            </button>
          </div>

          @if (!showPreview) {
          <textarea
            class="form-control content-textarea markdown-editor"
            name="content"
            rows="12"
            [(ngModel)]="post.content"
            placeholder="# Your updated content..."
            required
            minlength="10"
          ></textarea>
          } @else {
          <article class="markdown-body p-4 border rounded-3 bg-light">
            <markdown [data]="post.content"></markdown>
          </article>

          }
        </div>
        <div class="mb-4">
          <input
            type="file"
            class="d-none"
            id="fileInput"
            accept="image/*,video/*"
            multiple
            (change)="onFileChange($event)"
            #fileInput
          />

          @if (existingMedia.length > 0) {
          <div class="mb-3">
            <p class="fw-semibold text-muted mb-2">Current Media:</p>
            <div class="d-flex flex-wrap gap-2">
              @for (media of existingMedia; track media.url) {
              <div
                class="position-relative rounded-3 overflow-hidden bg-dark shadow-sm"
                style="width: 120px; height: 120px"
              >
                <button
                  type="button"
                  class="btn btn-danger btn-sm rounded-circle position-absolute top-0 end-0 m-2 z-3"
                  (click)="removeExistingMedia(media.url)"
                >
                  <i class="bi bi-x-lg"></i>
                </button>
                @if (media.type === 'image') {
                <img
                  [src]="'http://localhost:8080/image/' + media.url"
                  class="w-100 h-100 object-fit-cover"
                />
                } @else {
                <video
                  [src]="'http://localhost:8080/video/' + media.url"
                  class="w-100 h-100 object-fit-cover"
                  controls
                ></video>
                }
              </div>
              }
            </div>
          </div>
          }
          <div
            class="file-upload-area p-4 text-center border-2 border-dashed rounded-3 cursor-pointer"
            (click)="fileInput.click()"
            (dragover)="onDragOver($event)"
            (drop)="onDrop($event)"
            [class.dragover]="dragOver"
          >
            <i class="bi bi-cloud-plus display-5 text-primary mb-2"></i>
            <p class="fw-semibold mb-1">Add or replace media</p>
            <p class="text-muted small mb-0">Images & videos (JPG, PNG, MP4, WebM)</p>
          </div>
          @if (newFiles.length > 0) {
          <div class="mt-3">
            <p class="fw-semibold text-muted mb-2">New Files:</p>
            <div class="d-flex flex-wrap gap-2">
              @for (file of newFiles; track file.id) {
              <div
                class="position-relative rounded-3 overflow-hidden bg-dark shadow-sm"
                style="width: 120px; height: 120px"
              >
                <button
                  type="button"
                  class="btn btn-danger btn-sm rounded-circle position-absolute top-0 end-0 m-2 z-3"
                  (click)="removeNewFile(file.id)"
                >
                  <i class="bi bi-x-lg"></i>
                </button>
                @if (file.isImage) {
                <img [src]="file.preview" class="w-100 h-100 object-fit-cover" />
                } @else {
                <video [src]="file.preview" class="w-100 h-100 object-fit-cover" controls></video>
                }
              </div>
              }
            </div>
          </div>
          }
        </div>
        <div class="d-flex gap-3">
          <button
            type="submit"
            class="btn btn-success btn-lg flex-fill submit-btn fw-semibold"
            [disabled]="!updateForm.valid || isSubmitting"
          >
            @if (isSubmitting) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            } @else {
            <i class="bi bi-check2-circle me-2"></i>
            } Save Changes
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary btn-lg flex-fill"
            (click)="cancel()"
          >
            <i class="bi bi-x-circle me-2"></i>
            Cancel
          </button>
        </div>
        @if (error) {
        <div
          class="alert alert-danger d-flex align-items-center mt-3 py-3 px-4 rounded-3"
          role="alert"
        >
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <div><strong>Error:</strong> {{ error }}</div>
        </div>
        }
      </form>
    </div>
  </div>
</div>

}
